{% extends "base.html" %}

{% block title %}Prediction Result - Crop Prediction System{% endblock %}

{% block styles %}
<style>
    .result-container {
        min-height: 60vh;
        display: flex;
        align-items: center;
        padding: 2rem 0;
    }
    
    .result-card {
        max-width: 600px;
        margin: 0 auto;
    }
    
    .crop-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }
    
    .success-icon {
        color: #28a745;
    }
    
    .error-icon {
        color: #dc3545;
    }
    
    .result-text {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 2rem;
    }
    
    .crop-name {
        font-size: 2.5rem;
        font-weight: bold;
        color: #2c3e50;
        text-transform: capitalize;
        margin-bottom: 1rem;
        padding: 1rem;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .crop-info {
        background: linear-gradient(135deg, #667eea20, #764ba220);
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem 0;
    }
    
    .action-buttons {
        gap: 1rem;
    }
    
    .btn-success {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
    }
    
    .btn-secondary {
        background: linear-gradient(45deg, #6c757d, #495057);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="container result-container">
    <div class="result-card">
        <div class="card text-center">
            <div class="card-body p-5">
                {% if error %}
                    <i class="fas fa-exclamation-triangle crop-icon error-icon"></i>
                    <h2 class="result-text text-danger">Prediction Failed</h2>
                    <div class="alert alert-danger">
                        {{ prediction.result if prediction else "Unknown error occurred" }}
                    </div>
                    <p class="text-muted">Please check your input values and try again.</p>
                {% else %}
                    <i class="fas fa-seedling crop-icon success-icon"></i>
                    <h2 class="result-text text-success">Recommended Crop</h2>
                    <div class="crop-name">{{ prediction.recommended_crop }}</div>
                    
                    <div class="crop-info">
                        <h5><i class="fas fa-info-circle me-2"></i>Prediction Result</h5>
                        <p class="text-muted mb-0">
                            {{ prediction.result }}
                        </p>
                    </div>
                    
                    <div class="crop-info">
                        <h5><i class="fas fa-chart-bar me-2"></i>Yield Estimation</h5>
                        <p class="text-muted mb-0">
                            {{ prediction.yield_estimation }}
                        </p>
                    </div>
                    
                    <div class="crop-info">
                        <h5><i class="fas fa-star me-2"></i>Suitability Score</h5>
                        <p class="text-muted mb-0">
                            {{ prediction.suitability_score }}%
                        </p>
                    </div>
                    
                    {% if prediction.recommendations %}
                    <div class="crop-info">
                        <h5><i class="fas fa-lightbulb me-2"></i>Recommendations</h5>
                        <ul class="text-muted mb-0">
                            {% if prediction.recommendations is string %}
                                {% set recommendations = prediction.recommendations.split('; ') %}
                                {% for recommendation in recommendations %}
                                    {% if recommendation %}
                                    <li>{{ recommendation }}</li>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                {% for recommendation in prediction.recommendations %}
                                <li>{{ recommendation }}</li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %}
                {% endif %}
                
                <div class="d-flex justify-content-center action-buttons mt-4">
                    <a href="{{ url_for('main.index') }}" class="btn btn-success">
                        <i class="fas fa-redo me-2"></i>Try Another Prediction
                    </a>
                    <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
                        <i class="fas fa-chart-bar me-2"></i>View Analytics
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% if not error and prediction %}
<section class="container my-5">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-seedling me-2"></i>Crop Information: {{ prediction.recommended_crop.title() }}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-leaf me-2"></i>Growing Tips:</h6>
                            <div class="alert alert-info">
                                <ul class="mb-0">
                                    {% if prediction.recommended_crop.lower() == 'rice' %}
                                    <li>Requires flooded fields for optimal growth</li>
                                    <li>Plant during monsoon season</li>
                                    <li>Harvest in 3-4 months</li>
                                    {% elif prediction.recommended_crop.lower() == 'wheat' %}
                                    <li>Best grown in cooler months</li>
                                    <li>Requires well-drained soil</li>
                                    <li>Harvest in 4-6 months</li>
                                    {% elif prediction.recommended_crop.lower() == 'maize' %}
                                    <li>Needs warm weather and adequate rainfall</li>
                                    <li>Plant after last frost</li>
                                    <li>Harvest in 60-90 days</li>
                                    {% else %}
                                    <li>Follow recommended planting seasons</li>
                                    <li>Ensure proper soil preparation</li>
                                    <li>Monitor for pests and diseases</li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-flask me-2"></i>Nutritional Requirements:</h6>
                            <div class="alert alert-warning">
                                <ul class="mb-0">
                                    <li><strong>Nitrogen:</strong> Essential for leaf growth</li>
                                    <li><strong>Phosphorus:</strong> Important for root development</li>
                                    <li><strong>Potassium:</strong> Helps with disease resistance</li>
                                    <li><strong>pH:</strong> Maintain optimal soil pH levels</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
// Add some interactive effects
document.addEventListener('DOMContentLoaded', function() {
    // Animate the result card
    const resultCard = document.querySelector('.result-card');
    if (resultCard) {
        resultCard.style.opacity = '0';
        resultCard.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            resultCard.style.transition = 'all 0.6s ease';
            resultCard.style.opacity = '1';
            resultCard.style.transform = 'translateY(0)';
        }, 100);
    }
    
    // Add confetti effect for successful predictions
    // Simple confetti effect
    function createConfetti() {
        const colors = ['#667eea', '#764ba2', '#28a745', '#ffc107'];
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.style.cssText = `
                position: fixed;
                top: -10px;
                left: ${Math.random() * 100}%;
                width: 10px;
                height: 10px;
                background: ${colors[Math.floor(Math.random() * colors.length)]};
                pointer-events: none;
                border-radius: 50%;
                animation: fall ${Math.random() * 2 + 3}s linear forwards;
                z-index: 9999;
            `;
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 5000);
        }
    }
    
    // Add keyframes for confetti animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
    
    // Trigger confetti after a short delay if there's no error
    if (typeof error === 'undefined' || !error) {
        setTimeout(createConfetti, 500);
    }
});
</script>
{% endblock %}